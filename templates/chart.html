<!DOCTYPE html>
<html>
<head>
    <title>蛋白质数据图表</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
</head>
<body>
    <h1>蛋白质数据图表</h1>
    <form id="queryForm">
        <label for="proteinID">输入 ProteinID：</label>
        <input type="text" id="proteinID" name="proteinID">
        <input type="submit" value="提交">
    </form>
    <div id="main" style="width: 1000px; height: 600px;"></div>
    <script>
        // 定义颜色映射
        var speciesColors = {
            'At': '#1f77b4', // 蓝色
            'Ch': '#ff7f0e', // 橙色
            'Os': '#2ca02c', // 绿色
            'Sl': '#d62728', // 红色
            'Zm': '#9467bd', // 紫色
        };

        document.getElementById('queryForm').addEventListener('submit', function(e) {
            e.preventDefault(); // 阻止表单传统提交
            var proteinID = document.getElementById('proteinID').value;
            fetchData(proteinID); // 根据 proteinID 获取数据
        });

        function fetchData(proteinID) {
            var url = '/data';
            if (proteinID) {
                url += '?proteinID=' + encodeURIComponent(proteinID); // 如果提供了 proteinID，则将其附加到 URL 上
            }

            fetch(url).then(response => response.json()).then(data => {
                var categoryData = data.map(item => item.proteinID);
                var barData = data.map(item => ({
                    value: item.average,
                    itemStyle: {
                        color: speciesColors[item.speciesName] || '#7f7f7f' // 默认颜色，如果 speciesName 没有映射颜色
                    }
                }));
                var errorData = data.map((item, index) => [
                    index, item.average - item.error, item.average + item.error, item.speciesName
                ]);

                var option = {
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {type: 'shadow'}
                    },
                    title: {text: 'Error Bar Chart'},
                    legend: {data: ['bar', 'error']},
                    dataZoom: [{type: 'slider', start: 0, end: 100}, {type: 'inside', start: 0, end: 100}],
                    xAxis: {type: 'category', data: categoryData},
                    yAxis: {},
                    series: [{
                        name: 'bar',
                        type: 'bar',
                        data: barData
                    }, {
                        name: 'error',
                        type: 'custom',
                        renderItem: function (params, api) {
                            var xValue = params.dataIndex;
                            var highPoint = api.coord([xValue, api.value(2)]);
                            var lowPoint = api.coord([xValue, api.value(1)]);
                            var speciesName = api.value(3);
                            var barWidth = api.size([1, 0])[0] * 0.1;
                            return {
                                type: 'group',
                                children: [{
                                    type: 'line',
                                    shape: {x1: highPoint[0] - barWidth, y1: highPoint[1], x2: highPoint[0] + barWidth, y2: highPoint[1]},
                                    style: {stroke: speciesColors[speciesName] || 'black', lineWidth: 2} // 使用 speciesName 对应的颜色

                                }, {
                                    type: 'line',
                                    shape: {x1: highPoint[0], y1: highPoint[1], x2: lowPoint[0], y2: lowPoint[1]},
                                    style: {stroke: speciesColors[speciesName] || 'black', lineWidth: 2}
                                }, {
                                    type: 'line',
                                    shape: {x1: lowPoint[0] - barWidth, y1: lowPoint[1], x2: lowPoint[0] + barWidth, y2: lowPoint[1]},
                                    style: {stroke: speciesColors[speciesName] || 'black', lineWidth: 2}
                                }]
                            };
                        },
                        data: errorData,
                        z: 3
                    }]
                };

                var chartDom = document.getElementById('main');
                var myChart = echarts.init(chartDom);
                myChart.setOption(option);
            });
        }

        // 初始加载时不带参数调用，显示所有数据
        fetchData();
    </script>
</body>
</html>
